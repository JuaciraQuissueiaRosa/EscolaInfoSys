<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - EscolaInfoSys</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/EscolaInfoSys.styles.css" asp-append-version="true" />
    <link href="https://unpkg.com/tabler@1.0.0/dist/css/tabler.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://cdn.syncfusion.com/ej2/23.1.36/bootstrap5.css" rel="stylesheet" />
    @RenderSection("Styles", required: false)
   
</head>
<body class="layout-boxed">
    <header class="navbar navbar-expand-md d-print-none navbar-light bg-white shadow-sm">
        <div class="container-xl">
            <a href="/" class="navbar-brand">
                <span class="text-primary">Escola</span><span class="text-muted">InfoSys</span>
            </a>

            <div class="navbar-nav flex-row order-md-last align-items-center">
                @if (User.Identity.IsAuthenticated)
                {
                    var userName = User.Identity.Name;
                    var isAdmin = User.IsInRole("Administrator");
                    var isStaff = User.IsInRole("StaffMember");
                    var isStudent = User.IsInRole("Student");

                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link d-flex align-items-center lh-1 text-reset p-0" data-bs-toggle="dropdown" aria-label="Open user menu">
                            <span class="avatar avatar-sm me-2" style="background-image: url(/img/avatar-placeholder.png)"></span>
                            <div class="d-none d-xl-block">
                                <div class="fw-semibold">@userName</div>
                                <div class="mt-1 small text-muted">
                                    @(isAdmin ? "Admin" : isStaff ? "Staff" : "Student")
                                </div>
                            </div>
                        </a>

                        <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                            <a asp-controller="Account" asp-action="Profile" class="dropdown-item">
                                <i class="fa fa-user me-2"></i> My Profile
                            </a>
                            <a asp-controller="Account" asp-action="EditProfile" class="dropdown-item">
                                <i class="fa fa-edit me-2"></i> Edit Profile
                            </a>
                            <a asp-controller="Account" asp-action="ChangePassword" class="dropdown-item">
                                <i class="fa fa-lock me-2"></i> Change Password
                            </a>

                            @if (isAdmin)
                            {
                                <div class="dropdown-divider"></div>
                                <a asp-controller="FormGroups" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-layer-group me-2"></i> Manage Form Groups
                                </a>
                                <a asp-controller="StaffMembers" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-users-cog me-2"></i> Manage Staff
                                </a>
                                <a asp-controller="Courses" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-book me-2"></i> Manage Courses
                                </a>
                                <a asp-controller="Students" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-user-graduate me-2"></i> My Students
                                </a>
                              
                            }

                            @if (isStaff)
                            {
                                <div class="dropdown-divider"></div>
                              
                                <a asp-controller="Marks" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-pen me-2"></i> Enter Marks
                                </a>
                                <a asp-controller="Absences" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-calendar-times me-2"></i> Record Absences
                                </a>
                                <a asp-controller="Alerts" asp-action="Create" class="dropdown-item">
                                    <i class="fa fa-bullhorn me-2 text-danger"></i> Send Alert
                                </a>
                                <a asp-controller="Students" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-user-graduate me-2"></i> My Students
                                </a>
                            }

                            @if (isStudent)
                            {
                                <div class="dropdown-divider"></div>
                             
                             

                                <a asp-controller="StudentPortal" asp-action="Index" class="dropdown-item">
                                    <i class="fa fa-home me-2"></i> My Dashboard
                                </a>
                                <a asp-controller="StudentPortal" asp-action="MyMarks" class="dropdown-item">
                                    <i class="fa fa-file-alt me-2"></i> My Marks
                                </a>
                                <a asp-controller="StudentPortal" asp-action="MyAbsences" class="dropdown-item">
                                    <i class="fa fa-calendar-check me-2"></i> My Absences
                                </a>

                            }


                            <div class="dropdown-divider"></div>
                            <form asp-controller="Account" asp-action="Logout" method="post" class="dropdown-item">
                                <button type="submit" class="btn btn-link p-0 m-0 text-start w-100">
                                    <i class="fa fa-sign-out-alt me-2"></i> Logout
                                </button>
                            </form>
                        </div>
                    </div>
                }
                else
                {
                    <a class="nav-link px-3" asp-controller="Account" asp-action="Login">Login</a>
                    <div class="dropdown mt-2">
                        <button class="btn btn-outline-info dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <i class="fa fa-eye me-1"></i> Browse Information
                        </button>
                        <ul class="dropdown-menu">
                            <li>
                                <a class="dropdown-item" asp-controller="Courses" asp-action="Index">
                                    <i class="fa fa-book me-2"></i> View Courses
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" asp-controller="Subjects" asp-action="Index">
                                    <i class="fa fa-list me-2"></i> View Subjects
                                </a>
                            </li>
                        </ul>
                    </div>
                }
            </div>

        </div>
    </header>

    @* Alerts for administrator *@
    @if (User.Identity.IsAuthenticated && User.IsInRole("Administrator"))
    {
        <div class="container mt-4">
            @await Component.InvokeAsync("Alerts")
        </div>
    }

    <div id="notificationArea" class="position-fixed top-0 end-0 p-3" style="z-index: 1055;"></div>
    <main class="main-content" style="padding-bottom: 120px;">
        <div class="container-xl mt-4">
            @RenderBody()
        </div>
    </main>





    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.syncfusion.com/ej2/23.1.36/dist/ej2.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://unpkg.com/tabler@1.0.0/dist/js/tabler.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
    <script>
        function toggleDropdown() {
            var dropdown = document.getElementById("accountDropdown");
            dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        }

        document.addEventListener("click", function (e) {
            const dropdown = document.getElementById("accountDropdown");
            const toggle = document.querySelector(".dropdown-toggle");

            if (dropdown && toggle && !dropdown.contains(e.target) && !toggle.contains(e.target)) {
                dropdown.style.display = "none";
            }
        });
    </script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/notificationHub")
            .build();

        connection.on("ReceiveNotification", function (message, type) {
            const alertTypes = {
                success: "alert-success",
                error: "alert-danger",
                warning: "alert-warning",
                info: "alert-info"
            };

            const icons = {
                success: "fa-check-circle",
                error: "fa-times-circle",
                warning: "fa-exclamation-triangle",
                info: "fa-info-circle"
            };

            const alertClass = alertTypes[type] || "alert-info";
            const iconClass = icons[type] || "fa-info-circle";

            const toast = document.createElement("div");
            toast.className = `alert ${alertClass} alert-dismissible fade show shadow mb-2`;
            toast.role = "alert";
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fa ${iconClass} me-2"></i>
                    <div>${message}</div>
                    <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;

            document.getElementById("notificationArea").appendChild(toast);

            setTimeout(() => {
                toast.classList.remove("show");
                toast.classList.add("hide");
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        });

        connection.start().catch(function (err) {
            return console.error(err.toString());
        });
    </script>
   
</body>
</html>

